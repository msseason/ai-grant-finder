<!-- Add this in the <script> section, replace the existing AI functions -->

<script>
// Enhanced AI Assistant with multi-select
let aiConversationStep = 1;
let aiResponses = {};
let multiSelectMode = false;
let selectedOptions = [];

const aiQuestions = [
    {
        step: 1,
        question: "What industries does your business focus on?",
        hint: "Select ALL that apply - you can choose multiple",
        field: "industry",
        multiSelect: true,
        quickResponses: [
            "AI & Technology",
            "Workforce Development", 
            "Education & Training",
            "Healthcare",
            "Clean Energy",
            "Entrepreneurship"
        ]
    },
    {
        step: 2,
        question: "Who are your primary beneficiaries?",
        hint: "Select ALL that apply - you can choose multiple",
        field: "audience",
        multiSelect: true,
        quickResponses: [
            "Displaced Workers",
            "Underemployed",
            "Aspiring Entrepreneurs",
            "Small Businesses",
            "Veterans",
            "Underserved Communities"
        ]
    },
    {
        step: 3,
        question: "What specific problem does your business solve?",
        hint: "Describe the main challenge you address",
        field: "problem",
        multiSelect: false
    },
    {
        step: 4,
        question: "What makes your solution unique?",
        hint: "What sets you apart from competitors?",
        field: "unique",
        multiSelect: false
    },
    {
        step: 5,
        question: "What measurable impact have you created?",
        hint: "Numbers, percentages, specific outcomes",
        field: "impact",
        multiSelect: false
    }
];

function showAIAssistant() {
    console.log('AI Assistant launched');
    document.getElementById('aiAssistantCard').style.display = 'block';
    aiConversationStep = 1;
    aiResponses = {};
    selectedOptions = [];
    
    document.getElementById('aiConversation').innerHTML = `
        <div class="ai-message">
            <strong>AI Assistant:</strong>
            <p>Hello! Let's create your grant-winning profile together.</p>
            <p><strong>Question 1 of 5:</strong> What industries does your business focus on?</p>
            <p style="font-size: 0.9rem; opacity: 0.8;">Select ALL that apply - you can choose multiple, then click Continue</p>
        </div>
    `;
    
    document.getElementById('aiAssistantCard').scrollIntoView({ behavior: 'smooth' });
    updateQuickResponses();
}

function updateQuickResponses() {
    const currentQuestion = aiQuestions[aiConversationStep - 1];
    const container = document.getElementById('quickResponses');
    
    if (currentQuestion.quickResponses) {
        multiSelectMode = currentQuestion.multiSelect;
        
        if (multiSelectMode) {
            // Multi-select mode with checkboxes
            container.innerHTML = currentQuestion.quickResponses.map(response => `
                <label style="display: flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.2); color: white; padding: 0.75rem 1rem; border: 1px solid white; border-radius: 6px; cursor: pointer;">
                    <input type="checkbox" value="${response}" onchange="toggleSelection('${response}')" style="width: auto; margin: 0;">
                    <span>${response}</span>
                </label>
            `).join('');
            
            // Add Continue button for multi-select
            container.innerHTML += `
                <button onclick="submitMultiSelect()" style="background: white; color: #667eea; padding: 0.75rem 2rem; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 1rem;">
                    Continue with Selected (${selectedOptions.length})
                </button>
            `;
        } else {
            // Single select mode
            container.innerHTML = currentQuestion.quickResponses.map(response => 
                `<button onclick="selectQuickResponse('${response}')" style="background: rgba(255,255,255,0.2); color: white; padding: 0.5rem 1rem; border: 1px solid white; border-radius: 6px; cursor: pointer;">${response}</button>`
            ).join('');
        }
    } else {
        container.innerHTML = '';
        multiSelectMode = false;
    }
}

function toggleSelection(option) {
    if (selectedOptions.includes(option)) {
        selectedOptions = selectedOptions.filter(o => o !== option);
    } else {
        selectedOptions.push(option);
    }
    
    // Update button text
    const button = document.querySelector('#quickResponses button[onclick="submitMultiSelect()"]');
    if (button) {
        button.textContent = `Continue with Selected (${selectedOptions.length})`;
    }
}

function submitMultiSelect() {
    if (selectedOptions.length === 0) {
        alert('Please select at least one option');
        return;
    }
    
    const message = selectedOptions.join(', ');
    document.getElementById('aiInput').value = message;
    sendAIMessage();
    selectedOptions = [];
}

function selectQuickResponse(response) {
    document.getElementById('aiInput').value = response;
    sendAIMessage();
}

function sendAIMessage() {
    const input = document.getElementById('aiInput');
    const message = input.value.trim();
    
    if (!message) return;

    const conversation = document.getElementById('aiConversation');
    conversation.innerHTML += `
        <div style="background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 8px; margin: 1rem 0; text-align: right;">
            <strong>You:</strong>
            <p>${message}</p>
        </div>
    `;

    const currentQuestion = aiQuestions[aiConversationStep - 1];
    aiResponses[currentQuestion.field] = message;
    input.value = '';
    aiConversationStep++;

    if (aiConversationStep <= aiQuestions.length) {
        const nextQuestion = aiQuestions[aiConversationStep - 1];
        setTimeout(() => {
            conversation.innerHTML += `
                <div class="ai-message" style="margin: 1rem 0;">
                    <strong>AI Assistant:</strong>
                    <p><strong>Question ${aiConversationStep} of ${aiQuestions.length}:</strong> ${nextQuestion.question}</p>
                    ${nextQuestion.hint ? `<p style="font-size: 0.9rem; opacity: 0.8;">${nextQuestion.hint}</p>` : ''}
                </div>
            `;
            conversation.scrollTop = conversation.scrollHeight;
            updateQuickResponses();
        }, 500);
    } else {
        setTimeout(() => generateOptimizedProfile(), 500);
    }

    conversation.scrollTop = conversation.scrollHeight;
}

// Rest of the AI functions remain the same...
</script>