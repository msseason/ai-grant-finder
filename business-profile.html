<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Profile - AI Grant Finder Pro</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .ai-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }
        .ai-banner h2 { color: white; margin-bottom: 1rem; }
        .ai-trigger {
            background: white;
            color: #667eea;
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header"><h2>üöÄ Grant Finder</h2></div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item"><span class="icon">üìä</span> Dashboard</a>
                <a href="business-profile.html" class="nav-item active"><span class="icon">üè¢</span> Business Profile</a>
                <a href="grants.html" class="nav-item"><span class="icon">üîç</span> Browse Grants</a>
                <a href="applications.html" class="nav-item"><span class="icon">üìù</span> My Applications</a>
                <a href="reports.html" class="nav-item"><span class="icon">üìà</span> Reports</a>
                <a href="profile.html" class="nav-item"><span class="icon">üë§</span> Account Settings</a>
                <a href="login.html" class="nav-item"><span class="icon">üö™</span> Logout</a>
            </nav>
        </aside>

        <main class="main-content">
            <header class="content-header">
                <h1>Business Profile</h1>
                <div class="header-actions">
                    <button class="btn btn-success" onclick="saveProfile()">üíæ Save Profile</button>
                </div>
            </header>

            <div class="ai-banner">
                <h2>ü§ñ AI-Powered Profile Assistant</h2>
                <p style="margin-bottom: 1.5rem;">Let our expert AI help you create a grant-winning business profile</p>
                <button class="ai-trigger" onclick="showAI()">‚ú® Launch AI Assistant</button>
            </div>

            <div class="card">
                <h3>Profile Completion</h3>
                <div style="height: 20px; background: #e5e7eb; border-radius: 10px; overflow: hidden;">
                    <div id="progress" style="height: 100%; background: #10b981; width: 0%; transition: width 0.5s;"></div>
                </div>
                <p id="progressText" style="margin-top: 0.5rem; color: #6b7280;">0% Complete</p>
            </div>

            <div id="aiCard" class="card" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 style="color: white;">ü§ñ AI Assistant</h2>
                    <button onclick="hideAI()" style="background: none; border: none; color: white; font-size: 2rem; cursor: pointer;">&times;</button>
                </div>
                <div id="conversation" style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 8px; margin-bottom: 1rem; max-height: 400px; overflow-y: auto;">
                    <p><strong>Question 1 of 5:</strong> What industries does your business focus on?</p>
                    <p style="font-size: 0.9rem; opacity: 0.8;">Select ALL that apply, then click Continue</p>
                </div>
                <div id="options" style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem;"></div>
                <div style="display: flex; gap: 1rem;">
                    <input type="text" id="aiInput" placeholder="Or type your answer..." style="flex: 1; padding: 0.75rem; border: none; border-radius: 8px;">
                    <button onclick="sendMessage()" style="background: white; color: #667eea; padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Send</button>
                </div>
            </div>

            <div class="card">
                <h2>üìã Basic Information</h2>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div>
                        <label>Business Name *</label>
                        <input type="text" id="businessName" required placeholder="Your Company LLC" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                    </div>
                    <div>
                        <label>Business Structure *</label>
                        <select id="structure" required style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                            <option value="">Select...</option>
                            <option value="llc">LLC</option>
                            <option value="corp">Corporation</option>
                            <option value="sole">Sole Proprietor</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üìç Location & Reach</h2>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                    <div>
                        <label>City *</label>
                        <input type="text" id="city" required placeholder="Chicago" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                    </div>
                    <div>
                        <label>State *</label>
                        <input type="text" id="state" required placeholder="Illinois" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <label>Geographic Reach *</label>
                    <select id="reach" required style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;">
                        <option value="">Select...</option>
                        <option value="local">Local</option>
                        <option value="regional">Regional</option>
                        <option value="statewide">Statewide</option>
                        <option value="nationwide">Nationwide</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h2>üìù Business Description</h2>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div>
                        <label>Mission Statement *</label>
                        <textarea id="mission" rows="3" required placeholder="What is your core mission?" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;"></textarea>
                    </div>
                    <div>
                        <label>Problem You're Solving *</label>
                        <textarea id="problem" rows="4" required placeholder="What problem do you address?" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;"></textarea>
                    </div>
                    <div>
                        <label>Your Solution *</label>
                        <textarea id="solution" rows="4" required placeholder="How do you solve it?" style="width: 100%; padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 8px;"></textarea>
                    </div>
                </div>
            </div>

            <div class="card">
                <button class="btn btn-success btn-large" onclick="saveProfile()" style="width: 100%;">üíæ Save Complete Profile</button>
            </div>
        </main>
    </div>

    <script>
        // Prevent redirect - check auth but don't redirect
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{"email":"demo@grantfinder.com"}');
        console.log('User:', currentUser.email);

        let step = 1;
        let selected = [];
        let answers = {};

        const questions = [
            {q: "What industries does your business focus on?", multi: true, opts: ["AI & Technology", "Workforce Development", "Education", "Healthcare"]},
            {q: "Who are your primary beneficiaries?", multi: true, opts: ["Displaced Workers", "Underemployed", "Entrepreneurs", "Small Businesses"]},
            {q: "What problem does your business solve?", multi: false},
            {q: "What makes your solution unique?", multi: false},
            {q: "What measurable impact have you created?", multi: false}
        ];

        function showAI() {
            document.getElementById('aiCard').style.display = 'block';
            step = 1;
            selected = [];
            answers = {};
            updateQuestion();
        }

        function hideAI() {
            document.getElementById('aiCard').style.display = 'none';
        }

        function updateQuestion() {
            const q = questions[step - 1];
            const conv = document.getElementById('conversation');
            conv.innerHTML = `<p><strong>Question ${step} of 5:</strong> ${q.q}</p>`;
            
            const opts = document.getElementById('options');
            if (q.opts) {
                opts.innerHTML = q.opts.map(o => `
                    <label style="display: flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.2); padding: 0.75rem; border-radius: 6px; cursor: pointer;">
                        <input type="checkbox" value="${o}" onchange="toggle('${o}')" style="width: auto;">
                        <span>${o}</span>
                    </label>
                `).join('') + `<button onclick="continueMulti()" style="background: white; color: #667eea; padding: 0.75rem; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 0.5rem;">Continue (${selected.length})</button>`;
            } else {
                opts.innerHTML = '';
            }
        }

        function toggle(opt) {
            if (selected.includes(opt)) {
                selected = selected.filter(s => s !== opt);
            } else {
                selected.push(opt);
            }
            document.querySelector('button[onclick="continueMulti()"]').textContent = `Continue (${selected.length})`;
        }

        function continueMulti() {
            if (selected.length === 0) {
                alert('Please select at least one option');
                return;
            }
            document.getElementById('aiInput').value = selected.join(', ');
            sendMessage();
            selected = [];
        }

        function sendMessage() {
            const input = document.getElementById('aiInput');
            const msg = input.value.trim();
            if (!msg) return;

            const conv = document.getElementById('conversation');
            conv.innerHTML += `<div style="background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 8px; margin: 1rem 0; text-align: right;"><strong>You:</strong> ${msg}</div>`;
            
            answers[`q${step}`] = msg;
            input.value = '';
            step++;

            if (step <= 5) {
                setTimeout(() => {
                    updateQuestion();
                    conv.scrollTop = conv.scrollHeight;
                }, 500);
            } else {
                setTimeout(generateProfile, 500);
            }
        }

        function generateProfile() {
            const conv = document.getElementById('conversation');
            conv.innerHTML += `
                <div style="background: rgba(255,255,255,0.2); padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                    <p><strong>‚úÖ Profile Generated!</strong></p>
                    <button onclick="applyProfile()" style="background: white; color: #667eea; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-top: 1rem; width: 100%;">Apply to Profile</button>
                </div>
            `;
        }

        function applyProfile() {
            document.getElementById('mission').value = `We empower ${answers.q2} to succeed in ${answers.q1} through innovative solutions.`;
            document.getElementById('problem').value = answers.q3 || 'Problem statement';
            document.getElementById('solution').value = answers.q4 || 'Solution statement';
            hideAI();
            alert('‚úÖ AI profile applied! Review and save.');
            updateProgress();
        }

        function saveProfile() {
            const profile = {
                businessName: document.getElementById('businessName').value,
                structure: document.getElementById('structure').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                reach: document.getElementById('reach').value,
                mission: document.getElementById('mission').value,
                problem: document.getElementById('problem').value,
                solution: document.getElementById('solution').value,
                userId: currentUser.email,
                lastUpdated: new Date().toISOString()
            };

            if (!profile.businessName || !profile.mission) {
                alert('‚ö†Ô∏è Please fill required fields');
                return;
            }

            localStorage.setItem('businessProfile_' + currentUser.email, JSON.stringify(profile));
            alert('‚úÖ Profile saved successfully!');
            window.location.href = 'dashboard.html';
        }

        function updateProgress() {
            const fields = ['businessName', 'structure', 'city', 'state', 'reach', 'mission', 'problem', 'solution'];
            let filled = 0;
            fields.forEach(f => {
                if (document.getElementById(f).value) filled++;
            });
            const pct = Math.round((filled / fields.length) * 100);
            document.getElementById('progress').style.width = pct + '%';
            document.getElementById('progressText').textContent = pct + '% Complete';
        }

        // Load existing profile
        const saved = JSON.parse(localStorage.getItem('businessProfile_' + currentUser.email) || '{}');
        if (saved.businessName) {
            document.getElementById('businessName').value = saved.businessName || '';
            document.getElementById('structure').value = saved.structure || '';
            document.getElementById('city').value = saved.city || '';
            document.getElementById('state').value = saved.state || '';
            document.getElementById('reach').value = saved.reach || '';
            document.getElementById('mission').value = saved.mission || '';
            document.getElementById('problem').value = saved.problem || '';
            document.getElementById('solution').value = saved.solution || '';
            updateProgress();
        }

        // Update progress on input
        document.querySelectorAll('input, select, textarea').forEach(el => {
            el.addEventListener('input', updateProgress);
            el.addEventListener('change', updateProgress);
        });

        console.log('Business Profile page loaded successfully');
    </script>
</body>
</html>